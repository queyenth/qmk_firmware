#include QMK_KEYBOARD_H

#include "features/achordion.h"

const uint16_t PROGMEM both_ctrl_esc[] = {LCTL_T(KC_T), RCTL_T(KC_N), COMBO_END};
combo_t key_combos[COMBO_COUNT] = {
  COMBO(both_ctrl_esc, KC_ESC)
};

enum layer_names {
  _CANARY = 0,
  _NAV,
  _NUM,
  _SYM,
  _FUN,
  _MEDIA,
  _BSPWM
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  /****************************************************************************************************
   *
   * Keymap: Default Layer in Canary
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * | Esc    |  F1  |  F2  |  F3  |  F4  |  F5  |  F6  |  F8  |  F9  |  F10 |  F12 | PSCR | SLCK | PAUS |  FN0 |  BOOT  |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * | =+     |  1!  |  2@  |  3#  |  4$  |  5%  |                           |  6^  |  7&  |  8*  |  9(  |  0)  | -_     |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * | Tab    |   W  |   L  |   Y  |   P  |   B  |                           |   Z  |   F  |   O  |   U  |  '"  | \|     |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * | Esc    |   C  |   R  |   S  |   T  |   G  |                           |   M  |   N  |   E  |   I  |   A  | ;:     |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * | Shift  |   Q  |   J  |   V  |   D  |   K  |                           |   X  |   H  |  /?  |  ,<  |  .>  | Shift  |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          | `~   | INS  | Left | Right|                                         | Up   | Down |  [{  |  ]}  |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------|Return| Space|
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_CANARY] = LAYOUT(
                     KC_ESC, KC_F1  ,KC_F2  ,KC_F3  ,KC_F4  ,KC_F5  ,KC_F6  ,KC_F7  ,KC_F8,
                     KC_EQL, KC_1   ,KC_2   ,KC_3   ,KC_4   ,KC_5   ,
                     KC_TAB,  KC_W   ,KC_L   ,KC_Y   ,KC_P   ,KC_B   ,
                     LCTL_T(KC_ESC),  LGUI_T(KC_C)   ,LALT_T(KC_R)   ,LSFT_T(KC_S)   ,LCTL_T(KC_T)   ,KC_G,
                     SC_LSPO, KC_Q   ,KC_J   ,KC_V   ,KC_D   ,KC_K   ,
                     KC_GRV ,KC_INS ,KC_LEFT,KC_RGHT,
                     LCTL_T(KC_CAPS),LALT_T(KC_TAB),
                     LGUI_T(KC_DEL),
                     LT(_NAV, KC_BSPC), LT(_NUM, KC_TAB) , KC_TAB,

                     KC_F9  ,KC_F10 ,KC_F11 ,KC_F12 ,KC_MUTE ,KC_VOLD  ,KC_VOLU, KC_MPLY, KC_MNXT,
                     KC_6   ,KC_7   ,KC_8   ,KC_9   ,KC_0   ,KC_MINS,
                     KC_Z   ,KC_F   ,KC_O   ,KC_U   ,KC_QUOT,KC_BSLS,
                     KC_M   ,RCTL_T(KC_N)   ,RSFT_T(KC_E)   ,RALT_T(KC_I)   ,RGUI_T(KC_A),   KC_SCLN,
                     KC_X   ,KC_H   ,KC_SLSH,KC_COMM,KC_DOT,SC_RSPC,
                     KC_UP  ,KC_DOWN,KC_LBRC,KC_RBRC,
                     RALT_T(KC_TAB),RCTL_T(KC_CAPS),
                     RGUI_T(KC_DEL),
                     KC_TAB,LT(_FUN, KC_ENTER),LT(_SYM, KC_SPC)
                     ),
  /****************************************************************************************************
   *
   * Keymap: NAV
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      | CTab | SCTab| GTab |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           | Left | Down |  Up  | Right| Caps |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           | Home | PgDn | PgUp | End  |Insert|        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,--------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------| Tab  | Space|
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_NAV] = LAYOUT(
                    _______, _______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
                    _______, _______   ,_______   ,_______   ,_______   ,_______,
                    _______, _______   ,_______   ,_______   ,_______   ,_______,
                    _______, _______   ,_______   ,_______   ,_______   ,_______,
                    _______, _______   ,_______   ,_______   ,_______   ,_______,
                    _______, _______   ,_______,_______,
                    _______,_______,
                    _______,
                    _______,_______,_______,
                    _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
                    _______   ,_______   ,_______   ,_______   ,_______   ,_______,
                    _______   ,LCTL(KC_TAB),RCS(KC_TAB)   ,LGUI(KC_TAB)   ,_______   ,_______,
                    KC_LEFT   ,KC_DOWN     ,KC_UP         ,KC_RGHT        ,KC_CAPS   ,_______,
                    KC_HOME   ,KC_PGDN     ,KC_PGUP       ,KC_END         ,KC_INS    ,_______,
                    _______  ,_______,_______,_______,
                    _______,_______,
                    _______,
                    _______,KC_TAB ,_______
                    ),
  /****************************************************************************************************
   *
   * Keymap: NUM
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |   {  |   7  |   8  |   9  |   }  |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |   (  |   4  |   5  |   6  |   )  |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |   [  |   1  |   2  |   3  |   ]  |        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------| Enter|   0  |
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_NUM] = LAYOUT(
              _______, _______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______,_______,
              _______,_______,
              _______,
              _______,_______,_______,
              _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
              _______   ,_______   ,_______   ,_______   ,_______   ,_______,
              KC_LCBR, KC_7      ,KC_8      ,KC_9      ,KC_RCBR      ,_______,
              KC_LPRN, KC_4      ,KC_5      ,KC_6      ,KC_RPRN   ,_______,
              KC_LBRC, KC_1      ,KC_2      ,KC_3      ,KC_RBRC   ,_______,
              _______  ,_______,_______,_______,
              _______,_______,
              _______,
              _______,_______ ,KC_0
              ),
  /****************************************************************************************************
   *
   * Keymap: SYM
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        |   !  |   @  |   #  |   $  |  %   |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |   ^  |   &  |   *  |   +  |  =   |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |   `  |   ~  |   -  |   ;  |  \   |                           |      |      |      |      |      |        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------| Enter| Space|
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_SYM] = LAYOUT(
              _______, _______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, KC_EXLM   ,KC_AT     ,KC_HASH   ,KC_DLR    ,KC_PERC,
              _______, KC_CIRC   ,KC_AMPR   ,KC_ASTR   ,KC_PLUS   ,KC_EQL,
              _______, KC_GRV    ,KC_TILD   ,KC_MINS   ,KC_SCLN   ,KC_NUHS,
              _______, _______   ,_______,_______,
              _______,_______,
              _______,
              _______,KC_TAB,_______,
              _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
              _______   ,_______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______  ,_______,_______,_______,
              _______,_______,
              _______,
              _______,_______ ,_______
              ),
  /****************************************************************************************************
   *
   * Keymap: FUN
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        |  F10 |  F7  |  F8  |  F9  |  :   |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |  F11 |  F4  |  F5  |  F6  |  _   |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |  F12 |  F1  |  F2  |  F3  |  |   |                           |      |      |      |      |      |        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------| Enter| Space|
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_FUN] = LAYOUT(
              _______, _______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, KC_F10    ,KC_F7     ,KC_F8     ,KC_F9     ,KC_COLN,
              _______, KC_F11    ,KC_F4     ,KC_F5     ,KC_F6     ,KC_UNDS,
              _______, KC_F12    ,KC_F1     ,KC_F2     ,KC_F3     ,KC_PIPE,
              _______, _______   ,_______,_______,
              _______,_______,
              _______,
              _______,_______,_______,
              _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______, _______   ,_______   ,_______   ,_______   ,_______,
              _______  ,_______,_______,_______,
              _______,_______,
              _______,
              _______,_______ ,_______
              ),
  /****************************************************************************************************
   *
   * Keymap: MEDIA
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        | BOOT |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        | Copy | Paste| Sshot|      |      |                           | Mute | Vol- | Vol+ | Prev | Next | Pause  |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------|Return| Space|
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_MEDIA] = LAYOUT(
               _______, _______   ,_______   ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
               _______, _______   ,_______   ,_______   ,_______   ,_______,
               _______, QK_BOOT   ,_______   ,_______,_______,_______,
               _______, LCTL(KC_C),LSFT(KC_INS)   ,KC_PSCR   ,_______   ,_______,
               _______, _______   ,_______   ,_______   ,_______   ,_______,
               _______, _______   ,_______,_______,
               _______,_______,
               _______,
               _______,_______,_______,

               _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
               _______   ,_______   ,_______   ,_______   ,_______   ,_______,
               _______,_______,_______,_______,_______,_______,
               KC_MUTE,KC_VOLD,KC_VOLU,KC_MPRV,KC_MNXT,KC_MPLY,
               _______,_______,_______,_______,_______,_______,
               _______,_______,_______,_______,
               _______,_______,
               _______,
               _______,_______ ,_______             
                     ),
  /****************************************************************************************************
   *
   * Keymap: BSPWM
   *
   * ,-------------------------------------------------------------------------------------------------------------------.
   * |        |      |      |      |      |      |      |      |      |      |      |      |      |      |      |        |
   * |--------+------+------+------+------+------+---------------------------+------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * |--------+------+------+------+------+------|                           +------+------+------+------+------+--------|
   * |        |  WS1 |  WS2 |  WS3 |  WS4 |  WS5 |                           |  WS6 |  WS7 |  WS8 |  WS9 |  WS0 |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        | WSF1 | WSF2 | WSF3 | WSF4 | WSF5 |                           | WSF6 | WSF7 | WSF8 | WSF9 | WSF0 |        |
   * |--------+------+------+------+------+------|                           |------+------+------+------+------+--------|
   * |        |      |      |      |      |      |                           |      |      |      |      |      |        |
   * `--------+------+------+------+------+-------                           `------+------+------+------+------+--------'
   *          |      |      |      |      |                                         |      |      |      |     |
   *          `---------------------------'                                         `---------------------------'
   *                                        ,--------------.         ,-------------.
   *                                        | Ctrl | Alt   |         | Alt   | Ctrl |
   *                                 ,------|------|-------|         |-------+------+------.
   *                                 |      |      | LOWER |         | RAISE |      |      |
   *                                 | BkSp | Esc  |-------|         |-------|Return| Space|
   *                                 |      |      | Gui   |         | Gui   |      |      |
   *                                 `---------------------'         `---------------------'
   */
  [_BSPWM] = LAYOUT(
               _______, _______   ,_______   ,_______  ,_______  ,_______  ,_______  ,_______  ,_______,
               _______, _______   ,_______   ,_______   ,_______   ,_______,
               _______, SGUI(KC_1) ,SGUI(KC_2) ,SGUI(KC_3) ,SGUI(KC_4) ,SGUI(KC_5),
               _______, SGUI(KC_F1),SGUI(KC_F2),SGUI(KC_F3),SGUI(KC_F4),SGUI(KC_F5),
               _______, _______   ,_______   ,_______   ,_______   ,_______,
               _______, _______   ,_______,_______,
               _______,_______,
               _______,
               _______,_______,_______,

               _______  ,_______ ,_______ ,_______ ,_______ ,_______  ,_______, _______, _______,
               _______   ,_______   ,_______   ,_______   ,_______   ,_______,
               SGUI(KC_6) ,SGUI(KC_7) ,SGUI(KC_8) ,SGUI(KC_9) ,SGUI(KC_0)  ,_______,
               SGUI(KC_F6),SGUI(KC_F7),SGUI(KC_F8),SGUI(KC_F9),SGUI(KC_F10),_______,
               _______, _______   ,_______   ,_______   ,_______   ,_______,
               _______  ,_______,_______,_______,
               _______,_______,
               _______,
               _______,_______ ,_______             
               )
};

layer_state_t layer_state_set_user(layer_state_t state) {
  state = update_tri_layer_state(state, _NAV, _SYM, _MEDIA);
  state = update_tri_layer_state(state, _NUM, _FUN, _BSPWM);
  return state;
}

bool process_record_user(uint16_t keycode, keyrecord_t* record) {
  if (!process_achordion(keycode, record)) { return false; }

  return true;
}

void matrix_scan_user(void) {
  achordion_task();
}
